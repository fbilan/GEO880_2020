"0","# extract whether multiple people are moving together (start and end at the same time at the same station)"
"0","biketrips_a$together <- FALSE"
"0",""
"0","time_diff_ok <- function(trip_a, trip_b){"
"0","  diff_starttime <- biketrips_a$start_time[trip_a]-biketrips_a$start_time[trip_b]"
"0","  diff_endtime <- abs(biketrips_a$end_time[trip_a]-biketrips_a$end_time[trip_b]) # absolute value because end_time is not sorted"
"0","  if (diff_starttime < 3 & diff_endtime < 3){"
"0","    return(""TRUE"")"
"0","  }"
"0","  else {"
"0","    return(""FALSE"")"
"0","  }"
"0","}"
"0",""
"0","for (trip in 1:nrow(biketrips_a)){"
"0","  for (minus in 1:100){"
"0","    if (trip-minus > 0){"
"0","      if (biketrips_a$start_station[trip] == biketrips_a$start_station[trip-minus] & biketrips_a$end_station[trip] == biketrips_a$end_station[trip-minus]){"
"0","      if (time_diff_ok(trip, trip-minus) == ""TRUE""){"
"0","        biketrips_a$together[trip] <- TRUE"
"0","        biketrips_a$together[trip-minus] <- TRUE"
"0","      }"
"0","    }"
"0","  }"
"0","  } "
"0","}"
"0","tog <- biketrips_a %>% filter(together == TRUE) %>% nrow()"
"0","ratio <- tog / nrow(biketrips_a)"
"0",""
"0","biketrips_a <- biketrips_a %>% "
"0","  mutate(purpose = ifelse(velocity > mean(biketrips_a$velocity) | passholder_type %in% c(""Monthly Pass"", ""Annual Pass"", ""Flex Pass"") & together == FALSE & duration < 15 & trip_route_category == ""One Way"", ""commuter"", ""tourist""))"
"0",""
"0","purpose_proportion_df <- biketrips_a %>% group_by(purpose) %>% summarize('Proportion [%]' = round(n()*100/nrow(biketrips_a),2))"
"0","purpose_proportion_df"
