"0","# Cumulative Trip Ratio Analysis"
"0","cumulative_trip_ratio <- hourly %>% group_by(Station_ID, Station_Name) %>% summarize(sum(diff), abs(sum(Count_Start, Count_End)))"
"0","colnames(cumulative_trip_ratio)[3:4] <- c('Difference', 'Total Turnover')"
"0","# hist(cumulative_trip_ratio$`Total Turnover`, breaks = 50)"
"0","cumulative_trip_ratio <- cumulative_trip_ratio %>% mutate(capacity = ifelse(`Total Turnover` > 1500, 192, ifelse(`Total Turnover` > 500, 64, 25)))"
"0","cumulative_trip_ratio <- cumulative_trip_ratio %>% mutate(ratio = round(Difference/capacity,2))"
"0","# hist(cumulative_trip_ratio$ratio, breaks = 20)"
"0","colnames(cumulative_trip_ratio)[1] <- ""start_station"" # rename column to make join possible"
"0","unique_station_coord <- biketrips_a %>% group_by(start_station, start_lat, start_lon) %>% summarize(count = n())"
"0","trip_ratio_sf <- cumulative_trip_ratio %>% full_join(unique_station_coord, copy = FALSE, by = ""start_station"")"
"0","trip_ratio_sf <- st_as_sf(trip_ratio_sf, coords = c(""start_lon"", ""start_lat""))"
"0","trip_ratio_sf <- trip_ratio_sf %>% mutate(category = ifelse(ratio > 0.33, ""pos"", ifelse(ratio < -0.33, ""neg"", ""balanced"")))"
"0",""
"0","leaflet(trip_ratio_sf) %>% "
"0","  addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(opacity = 0.6)) %>% "
"0","  setView(lat=34.06699, lng=-118.2909,zoom=12)%>%"
"0","  addCircleMarkers(data = trip_ratio_sf, col = ifelse(trip_ratio_sf$category == ""pos"", ""blue"", ifelse(trip_ratio_sf$category == ""neg"", ""red"", ""grey"")), fillOpacity = 0.5, radius = sqrt(abs(trip_ratio_sf$ratio))*7, stroke = FALSE, popup = paste(""Ratio: "", trip_ratio_sf$ratio))"
